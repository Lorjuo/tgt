<% content_for :title do %>
  <%= t ".title" %>
<% end %>

<% content_for :buttons do %>
  <%= link_to new_department_message_path(@department), :class => 'btn btn-primary' do %>
    <span class="glyphicon glyphicon-plus"></span>
    <%= t('general.create_model', :model => Message.model_name.human ) %>
  <% end if can?(:create, Message) && @department.present? %>
<% end %>

<div class="window box thin">
  <table id="messages_data_table"
    class="dataTable table table-bordered table-striped"
    data-source="<%=
      @department.present? ?
        department_messages_path(@department, format: "json") :
        messages_path(format: "json")
    %>">
    <thead>
      <tr>
        <th class="no-sort"></th>
        <th data-class="expand"><%= Message.human_attribute_name(:title) %></th>
        <th class="no-sort" data-hide="xxs,xs"><%= Message.human_attribute_name(:content) %></th>
        <th data-hide="xxs,xs"><%= Message.human_attribute_name(:department) %></th>
        <% if can? :update, Message %>
          <th class="no-sort"><%= t "general.actions" %></th>
        <% end %>
      </tr>
    </thead>

    <tbody>
  <% @messages.each do |message| %>
      <tr>
        <td><%= link_to(image_tag(message.image.file_url(:thumb)), message.image.file_url, :class => "fancybox") if message.image.present? %></td>
        <td><%= message.title %></td>
        <td>
          <%= truncate(strip_tags(message.content), length: 320, omission: '') %>
        </td>
        <td><%= link_to message.department.name, message.department, class: "pill" %></td>
        <% if can? :update, message %>
          <td>
            <%= link_to edit_message_path(message), :title => t("general.edit"), :data => {:toggle => "tooltip"} do %>
              <%= tag :span, :class => "glyphicon glyphicon-edit" %>
            <% end %>
            <% if can? :destroy, message %>
              <%= link_to message, :title => t("general.destroy"), data: { confirm: I18n.t('general.are_you_sure'), :toggle => "tooltip" }, method: :delete do %>
                <%= tag :span, :class => "glyphicon glyphicon-trash" %>
              <% end %>
            <% end %>
          </td>
        <% end %>
      </tr>
  <% end if false %>
    </tbody>
  </table>
</div>
