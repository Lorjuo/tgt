<!-- https://github.com/Studio-42/elFinder/wiki/Integration-with-TinyMCE-4.x -->
<script>
  function elFinderBrowser (field_name, url, type, win) {
    var params = '?department_id='+encodeURIComponent("<%= department.id %>");
    params += '&department_name='+encodeURIComponent("<%= department.name %>");
    var elfinder_url = '/elfinder/frontend'+params;    // use an absolute path!;

    tinymce.activeEditor.windowManager.open({
      file: elfinder_url,
      title: 'Filemanager',
      width: 900,  
      height: 540,
      resizable: 'yes'
    }, {
      setUrl: function (url) {
        win.document.getElementById(field_name).value = url;
      }
    });
    return false;
  }
</script>